name: Deploy to Server

on:
  push:
    branches:
      - dev  # DÃ©clenche le workflow sur les push vers la branche principale

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:

    - name: Setup SSH
      uses: webfactory/ssh-agent@v0.5.3
      with:
        ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}
      env:
        GIT_SSH_COMMAND: "ssh -o LogLevel=ERROR"
        
    - name: Add server to known_hosts
      run: |
        ssh-keyscan -H ${{ secrets.SECRET_SERVER }} >> ~/.ssh/known_hosts

    - name: Test SSH connection and permissions
      run: |
        ssh -o StrictHostKeyChecking=no ${{ secrets.SECRET_USER }}@${{ secrets.SECRET_SERVER }} "touch z && touch app/z"

          
    - name: Copy files via SCP
      run: |
        scp -vvv -o StrictHostKeyChecking=no a.txt ${{ secrets.SECRET_USER }}@${{ secrets.SECRET_SERVER }}:app/.
        
    - name: try ll
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.SECRET_SERVER }}
        username: ${{ secrets.SECRET_USER }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        port: 22
        script: ls       
    

   

    
